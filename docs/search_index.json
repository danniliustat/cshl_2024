[["ldsc-and-gene-set-analysis.html", "Chapter 8 LDSC and Gene-Set Analysis 8.1 LDSC (Linkage Disequilibrium Score Regression) 8.2 MAGMA (for Gene-Level Analysis)", " Chapter 8 LDSC and Gene-Set Analysis Due to privacy concern, there haven’t been many individual genotype datasets that are publically available online. So finding and preparing a genotype data for GWAS analysis can cost great efforts in research. Here are several analysis tools that are able to directly handle GWAS summary statistics and perform post-GWAS analysis. 8.1 LDSC (Linkage Disequilibrium Score Regression) LDSC is a popular tool to use when you only have the public results from GWAS analysis. LDSC aims to quantify the polygenic effects, such as population stratification, using regression analysis. Please check the original paper from Bulik-Sullivan et al.(2015). It has to be installed in command line and requires Anaconda python dstribution. We won’t practice this software here since the installation may depend on computer system. But you can try the examples on their website if your laptop satisfies the system requirements. LDSC Github page contains installation instructions. They also provide detailed examples on how to {estimate LD scores](https://github.com/bulik/ldsc/wiki/LD-Score-Estimation-Tutorial), estimate SNP heritability and genetic correlation among phenotypes and partition the heritability into categories using GWAS summary statistics. Below are two public courses that gives a good introduction to LDSC: Video 1: LD Score Regression I, Heritability and Partitioning Video 2: LD Score Regression II, Heritability and Partitioning 8.2 MAGMA (for Gene-Level Analysis) MAGMA is a statistical methods for gene-set analysis of multiple genetic markers. This method can be used when the individual marker’s effects are too weak to be detected, such as in polygenic traits. It aims to analyze multiple markers simultaneously to estimate their joint effects. Please check the paper from de Leewu et al.(2015). The analysis consists of two parts. One part is gene analysis, which examine the assiciation between each gene and phenotype using a multiple linear regression model. To perform the gene-set analysis, for each gene \\(g\\), we have the gene p-value \\(p_g\\) computed from gene analysis. We first transform the p-values \\(p_g\\) to Z-value: \\(z_g=\\Phi^{-1}(1-p_g)\\), where \\(\\Phi^{-1}\\) is the probit function For gene set analysis, we test whether genes exhibit a stronger association with the phenotype of interest compared to other genes within a specific gene-set \\(s\\) : \\(Z = \\beta_{0s} + S_s\\beta_s + \\epsilon\\) \\(\\beta_{0s}\\): intercept \\(S_s:\\) An indicator variable, with \\(S_g=1\\) for gene \\(g\\) in the gene set \\(s\\). \\(\\beta_s\\): effect of genes inside the gene sets compared to genes outside the region \\(\\epsilon\\): residual Then, MAGMA uses a t-test to test whether genes inside the test is more associated with the phenotype \\(\\beta_s&gt;0\\), against null \\(\\beta_s=0\\). The MAGMA program can be downloaded from MAGMA website and can be installed under multiple systems. You can check their manual HERE. Additionally, their website also provides a list of public GWAS summary statistics data for you to download and practice. Please check them HERE. The MAGMA installation packages are already downloaded inside Tools/MAGMA. 8.2.1 Prepare Annotation File First set the working directory: # change the path below to where you saved &quot;cshl_2024&quot; folder ## run in R Terminal mydir=&quot;/path/to/cshl_2024/Data/magma&quot; cd $mydir # R codes- run in R Console setwd(&quot;/path/to/cshl_2024/Data/magma&quot;) mydir&lt;-getwd() MAGMA directly runs on PLINK binary format files. We had .ped and .map files before. Let’s convert them to binary format .bed, .bim and .fam using PLINK. ## # both Mac and Windows can run in Terminal # windows users ../../Tools/PLINK/plink_win64_20231211/plink.exe \\ --noweb --file ../case_data/genotype_1k --out genotype_1k # macOS users ../../Tools/PLINK/plink_mac_20231211/plink \\ --noweb --file ../case_data/genotype_1k --out genotype_1k ## PLINK v1.90b7.2 64-bit (11 Dec 2023) www.cog-genomics.org/plink/1.9/ ## (C) 2005-2023 Shaun Purcell, Christopher Chang GNU General Public License v3 ## Logging to genotype_1k.log. ## Options in effect: ## --file ../case_data/genotype_1k ## --noweb ## --out genotype_1k ## ## Note: --noweb has no effect since no web check is implemented yet. ## 16384 MB RAM detected; reserving 8192 MB for main workspace. ## Scanning .ped file... 0%\b\b1%\b\b1%\b\b2%\b\b2%\b\b3%\b\b3%\b\b4%\b\b4%\b\b5%\b\b5%\b\b6%\b\b6%\b\b7%\b\b7%\b\b8%\b\b8%\b\b9%\b\b9%\b\b10%\b\b\b10%\b\b\b11%\b\b\b11%\b\b\b12%\b\b\b13%\b\b\b13%\b\b\b14%\b\b\b14%\b\b\b15%\b\b\b15%\b\b\b16%\b\b\b16%\b\b\b17%\b\b\b17%\b\b\b18%\b\b\b18%\b\b\b19%\b\b\b19%\b\b\b20%\b\b\b20%\b\b\b21%\b\b\b21%\b\b\b22%\b\b\b22%\b\b\b23%\b\b\b23%\b\b\b24%\b\b\b24%\b\b\b25%\b\b\b26%\b\b\b26%\b\b\b27%\b\b\b27%\b\b\b28%\b\b\b28%\b\b\b29%\b\b\b29%\b\b\b30%\b\b\b30%\b\b\b31%\b\b\b31%\b\b\b32%\b\b\b32%\b\b\b33%\b\b\b33%\b\b\b34%\b\b\b34%\b\b\b35%\b\b\b35%\b\b\b36%\b\b\b36%\b\b\b37%\b\b\b38%\b\b\b38%\b\b\b39%\b\b\b39%\b\b\b40%\b\b\b40%\b\b\b41%\b\b\b41%\b\b\b42%\b\b\b42%\b\b\b43%\b\b\b43%\b\b\b44%\b\b\b44%\b\b\b45%\b\b\b45%\b\b\b46%\b\b\b46%\b\b\b47%\b\b\b47%\b\b\b48%\b\b\b48%\b\b\b49%\b\b\b49%\b\b\b50%\b\b\b51%\b\b\b51%\b\b\b52%\b\b\b52%\b\b\b53%\b\b\b53%\b\b\b54%\b\b\b54%\b\b\b55%\b\b\b55%\b\b\b56%\b\b\b56%\b\b\b57%\b\b\b57%\b\b\b58%\b\b\b58%\b\b\b59%\b\b\b59%\b\b\b60%\b\b\b60%\b\b\b61%\b\b\b61%\b\b\b62%\b\b\b63%\b\b\b63%\b\b\b64%\b\b\b64%\b\b\b65%\b\b\b65%\b\b\b66%\b\b\b66%\b\b\b67%\b\b\b67%\b\b\b68%\b\b\b68%\b\b\b69%\b\b\b69%\b\b\b70%\b\b\b70%\b\b\b71%\b\b\b71%\b\b\b72%\b\b\b72%\b\b\b73%\b\b\b73%\b\b\b74%\b\b\b74%\b\b\b75%\b\b\b76%\b\b\b76%\b\b\b77%\b\b\b77%\b\b\b78%\b\b\b78%\b\b\b79%\b\b\b79%\b\b\b80%\b\b\b80%\b\b\b81%\b\b\b81%\b\b\b82%\b\b\b82%\b\b\b83%\b\b\b83%\b\b\b84%\b\b\b84%\b\b\b85%\b\b\b85%\b\b\b86%\b\b\b86%\b\b\b87%\b\b\b88%\b\b\b88%\b\b\b89%\b\b\b89%\b\b\b90%\b\b\b90%\b\b\b91%\b\b\b91%\b\b\b92%\b\b\b92%\b\b\b93%\b\b\b93%\b\b\b94%\b\b\b94%\b\b\b95%\b\b\b95%\b\b\b96%\b\b\b96%\b\b\b97%\b\b\b97%\b\b\b98%\b\b\b98%\b\b\b99%\b\b\b100%.ped scan complete (for binary autoconversion). ## Performing single-pass .bed write (1000 variants, 192 people). ## 0%\b\b1%\b\b2%\b\b3%\b\b4%\b\b5%\b\b6%\b\b7%\b\b8%\b\b9%\b\b10%\b\b\b11%\b\b\b12%\b\b\b13%\b\b\b14%\b\b\b15%\b\b\b16%\b\b\b17%\b\b\b18%\b\b\b19%\b\b\b20%\b\b\b21%\b\b\b22%\b\b\b23%\b\b\b24%\b\b\b25%\b\b\b26%\b\b\b27%\b\b\b28%\b\b\b29%\b\b\b30%\b\b\b31%\b\b\b32%\b\b\b33%\b\b\b34%\b\b\b35%\b\b\b36%\b\b\b37%\b\b\b38%\b\b\b39%\b\b\b40%\b\b\b41%\b\b\b42%\b\b\b43%\b\b\b44%\b\b\b45%\b\b\b46%\b\b\b47%\b\b\b48%\b\b\b49%\b\b\b50%\b\b\b51%\b\b\b52%\b\b\b53%\b\b\b54%\b\b\b55%\b\b\b56%\b\b\b57%\b\b\b58%\b\b\b59%\b\b\b60%\b\b\b61%\b\b\b62%\b\b\b63%\b\b\b64%\b\b\b65%\b\b\b66%\b\b\b67%\b\b\b68%\b\b\b69%\b\b\b70%\b\b\b71%\b\b\b72%\b\b\b73%\b\b\b74%\b\b\b75%\b\b\b76%\b\b\b77%\b\b\b78%\b\b\b79%\b\b\b80%\b\b\b81%\b\b\b82%\b\b\b83%\b\b\b84%\b\b\b85%\b\b\b86%\b\b\b87%\b\b\b88%\b\b\b89%\b\b\b90%\b\b\b91%\b\b\b92%\b\b\b93%\b\b\b94%--file: genotype_1k.bed + genotype_1k.bim + genotype_1k.fam written. Before we run the MAGMA for gene level analysis, we have to create a annotation file that map the SNPs to gene. ## both Mac and Windows can run in Terminal # windows users ../../Tools/MAGMA/magma_windows/magma --annotate --snp-loc genotype_1k.bim \\ --gene-loc NCBI37.3.gene.loc \\ --out genotype_1k # mac users ../../Tools/MAGMA/magma_v1.10_mac/magma --annotate --snp-loc genotype_1k.bim \\ --gene-loc NCBI37.3.gene.loc \\ --out genotype_1k ## Welcome to MAGMA v1.10 (custom) ## Using flags: ## --annotate ## --snp-loc genotype_1k.bim ## --gene-loc NCBI37.3.gene.loc ## --out genotype_1k ## ## Start time is 01:20:17, Monday 17 Jun 2024 ## ## Starting annotation... ## Reading gene locations from file NCBI37.3.gene.loc... ## 19427 gene locations read from file ## chromosome 1: 2016 genes ## chromosome 2: 1226 genes ## chromosome 3: 1050 genes ## chromosome 4: 745 genes ## chromosome 5: 856 genes ## chromosome 6: 1016 genes ## chromosome 7: 906 genes ## chromosome 8: 669 genes ## chromosome 9: 775 genes ## chromosome 10: 723 genes ## chromosome 11: 1275 genes ## chromosome 12: 1009 genes ## chromosome 13: 320 genes ## chromosome 14: 595 genes ## chromosome 15: 586 genes ## chromosome 16: 817 genes ## chromosome 17: 1147 genes ## chromosome 18: 271 genes ## chromosome 19: 1389 genes ## chromosome 20: 527 genes ## chromosome 21: 215 genes ## chromosome 22: 442 genes ## chromosome X: 805 genes ## chromosome Y: 47 genes ## Reading SNP locations from file genotype_1k.bim... ## 984 SNP locations read from file ## of those, 706 (71.75%) mapped to at least one gene ## Writing annotation to file genotype_1k.genes.annot ## for chromosome 1, 1960 genes are empty (out of 2016) ## for chromosome 2, 1184 genes are empty (out of 1226) ## for chromosome 3, 1023 genes are empty (out of 1050) ## for chromosome 4, 717 genes are empty (out of 745) ## for chromosome 5, 825 genes are empty (out of 856) ## for chromosome 6, 951 genes are empty (out of 1016) ## for chromosome 7, 869 genes are empty (out of 906) ## for chromosome 8, 651 genes are empty (out of 669) ## for chromosome 9, 757 genes are empty (out of 775) ## for chromosome 10, 692 genes are empty (out of 723) ## for chromosome 11, 1243 genes are empty (out of 1275) ## for chromosome 12, 982 genes are empty (out of 1009) ## for chromosome 13, 312 genes are empty (out of 320) ## for chromosome 14, 586 genes are empty (out of 595) ## for chromosome 15, 577 genes are empty (out of 586) ## for chromosome 16, 798 genes are empty (out of 817) ## for chromosome 17, 1131 genes are empty (out of 1147) ## for chromosome 18, 264 genes are empty (out of 271) ## for chromosome 19, 1365 genes are empty (out of 1389) ## for chromosome 20, 516 genes are empty (out of 527) ## for chromosome 21, 209 genes are empty (out of 215) ## for chromosome 22, 421 genes are empty (out of 442) ## for chromosome X, 794 genes are empty (out of 805) ## for chromosome Y, 45 genes are empty (out of 47) ## at least one SNP mapped to each of a total of 555 genes (out of 19427) ## ## ## End time is 01:20:17, Monday 17 Jun 2024 (elapsed: 00:00:00) 8.2.2 Use MAGMA for Gene-Set Analysis ## both Mac and Windows can run in Terminal # windows users ../../Tools/MAGMA/magma_windows/magma --bfile genotype_1k \\ --pheno file=phenotype_plink.txt \\ --gene-annot genotype_1k.genes.annot \\ --out younameit # mac users ../../Tools/MAGMA/magma_v1.10_mac/magma --bfile genotype_1k \\ --pheno file=phenotype_plink.txt \\ --gene-annot genotype_1k.genes.annot \\ --out younameit Interpret the result library(data.table) library(dplyr) magma_result &lt;- fread(&quot;younameit.genes.out&quot;) annotate &lt;- fread(&quot;NCBI37.3.gene.loc&quot;) # replace gene index with gene name magma_result[, 1] &lt;- annotate[match(as.matrix(magma_result[, 1]), as.matrix(annotate[, 1])), 6] # show some of the result head(magma_result) ## GENE CHR START STOP NSNPS NPARAM N ZSTAT P ## &lt;char&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; ## 1: VPS13D 1 12290101 12572099 1 1 192 1.88960 0.029407 ## 2: STPG1 1 24683489 24741587 1 1 192 0.10656 0.457570 ## 3: TMEM50A 1 25664789 25688852 1 1 192 -1.21080 0.887020 ## 4: NR0B2 1 27237975 27240567 1 1 192 -1.29790 0.902850 ## 5: FAM76A 1 28052490 28089426 1 1 192 -0.04252 0.516960 ## 6: CSF3R 1 36931644 36948915 1 1 192 -0.69858 0.757590 ## RSQ RSQ_ADJ ## &lt;num&gt; &lt;num&gt; ## 1: 2.4721e-02 0.019588 ## 2: 2.9078e-03 0.000000 ## 3: 1.0651e-04 0.000000 ## 4: 7.8625e-05 0.000000 ## 5: 2.2137e-03 0.000000 ## 6: 5.0257e-04 0.000000 # resummarize for manhattan plot qassoc = cbind(magma_result$CHR, magma_result$GENE, (magma_result$START+magma_result$STOP)/2, magma_result$P) colnames(qassoc) &lt;- c(&quot;CHR&quot;,&quot;SNP&quot;, &quot;BP&quot;, &quot;P&quot;) qassoc &lt;- as.data.frame(qassoc) qassoc$CHR &lt;- as.integer(qassoc$CHR) qassoc$BP &lt;- as.numeric(qassoc$BP) qassoc$P &lt;- as.numeric(qassoc$P) qassoc &lt;- qassoc %&gt;% arrange(P) head(qassoc) ## CHR SNP BP P ## 1 22 TCF20 42610394 0.00016134 ## 2 3 ATP13A5 193044672 0.00020216 ## 3 22 NDUFA6 42484209 0.00034808 ## 4 22 RAC2 37630820 0.00067431 ## 5 22 WBP2NL 42410271 0.00069317 ## 6 22 SEPT3 42383540 0.00077054 png(filename=paste0(&quot;Manhattan_Plot_for_magma.png&quot;)) manhattan(qassoc, col=c(&quot;dimgray&quot;, &quot;darkgoldenrod1&quot;), suggestiveline=T, genomewideline=F, annotatePval=0.001) dev.off() ## quartz_off_screen ## 2 8.2.3 Compare the Manhattan plots We can load the plot from MAGMA img &lt;- readPNG(&quot;Manhattan_Plot_for_magma.png&quot;) grid::grid.raster(img) This is the previous plot for SNPs. img &lt;- readPNG(&quot;../case_data/Manhattan_Plot_for_z-4-oh-Tam.png&quot;) grid::grid.raster(img) "]]
